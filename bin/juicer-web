#!/usr/bin/env python
import sys
import os
sys.path.insert(0, os.path.abspath('.'))
import web
import json
##############################################################################
# Routing

urls = (
    '/css/(.*\.css)', 'css',
    '/js/(.*\.js)', 'js',
    '/img/(.*)', 'img',
    '/rest/juicer/hello', 'juicer_hello',
    '(.*)', 'static',
    )

app = web.application(urls, globals())

##############################################################################
class juicer_hello:
    def GET(self):
        import juicer.juicer.Parser
        parser = juicer.juicer.Parser.Parser()
        args = parser.parser.parse_args(['hello'])
        juicer.utils.Log.LOG_LEVEL_CURRENT = 0
        juicer.utils.Log.log_debug(args)
        hello = args.j(args)
        web.header('Content-Type', 'application/json')
        return json.dumps(hello)

##############################################################################
class img:
    def GET(self, path):
        if path.endswith('gif'):
            type = 'gif'
        elif path.endswith('jpg'):
            type = 'jpeg'
        elif path.endswith('png'):
            type ='png'
        else:
            print "WTF? %s" % path

        web.header('Content-Type', 'image/%s' % type)
        return open('./static/img/%s' % path, 'r').read()

##############################################################################
class js:
    def GET(self, path):
        web.header('Content-Type', 'text/javascript')
        return open('./static/js/%s' % path, 'r').read()

##############################################################################
class css:
    def GET(self, path):
        web.header('Content-Type', 'text/css')
        return open('./static/css/%s' % path, 'r').read()


##############################################################################
class static:
    def GET(self, path):
        web.header('Content-Type', 'text/html')
        return open('./static/index.html', 'r').read()


##############################################################################
if __name__ == "__main__":
    app.run()
